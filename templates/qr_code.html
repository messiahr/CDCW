<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Scanner</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <!-- Button on top left (go back to form)-->
    <form action="/" method="get">
        <button class="back-button">‚Üê</button>
    </form>
    <div id="to-form" style="width:600px"></div>
    <div id="to-form"></div>
    <div id="qr-reader" style="width:600px"></div>
    <div id="qr-reader-results"></div>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>

    <!-- Radio buttons for multiple choice -->
    <p>Select Service:</p>
    <div class="radio-group" id="id-radio-buttons">
        <!-- Options will be populated here via JavaScript -->
    </div>

    <script>
    // Fetch radio button values from the server
        async function fetchRadioButtonValues() {
            const response = await fetch('/get-services');  // Call the '/get-ids' route
            const ids = await response.json();  // Parse the JSON response from the server

            // Get the container for radio buttons
            const radioContainer = document.getElementById("id-radio-buttons");

            // Clear the existing radio buttons (if any)
            radioContainer.innerHTML = "";

            // Populate the radio buttons with options
            ids.forEach(id => {
                const label = document.createElement("label");
                const input = document.createElement("input");

                input.type = "radio";
                input.name = "service";  // Ensure only one option can be selected at a time
                input.value = id;
                input.id = `service-${id}`;

                label.setAttribute("for", `service-${id}`);
                label.textContent = id;

                // Append the radio button to the container
                label.prepend(input);
                radioContainer.appendChild(label);
            });
        }

        // Handle the form submission (submit the selected radio button value)
        function submitSelection() {
            const selectedOption = document.querySelector('input[name="service"]:checked');

            if (!selectedOption) {
                alert("No selection made.");
                return;
            }

            fetch("/select-service", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    service: selectedOption.value
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log("Flask response:", data);
                alert(`Service "${data.selected_service}" sent to server`);
            })
            .catch(err => {
                console.error("Error sending selection:", err);
            });
        }

        // Call the fetch function when the page loads
        window.onload = function () {
            fetchRadioButtonValues();
        };
    </script>
</body>
</html>